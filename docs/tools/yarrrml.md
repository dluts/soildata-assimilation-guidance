# YARRRML

This cookbook provides a quickstart on using YARRRML to convert arbitrary soil data to RDF following the [glosis ontology](https://github.com/rapw3k/glosis) using a YARRRML approach. This work has initially been developed in the scope of the [Soils for Africa](https://www.soils4africa-h2020.eu/) project.

[YARRRML](https://rml.io/yarrrml/) is a human readable text-based representation for declarative Linked Data generation rules. YARRRML is encoded in [YAML](https://en.wikipedia.org/wiki/YAML), a widely used data serialization language designed to be human-friendly. YARRRML is an initiative of the [RML.io](https://rml.io) community which provides a set of tools to generate knowledge graphs.

## Glosis

The [glosis ontology](https://github.com/rapw3k/glosis) has been developed in the scope of the [SIEUSOIL project](https://www.sieusoil.eu), which aims at implementing and testing a shared China-EU Web Observatory platform that will provide Linked (Open) Data to monitor status and threats of soil and land resources. The GloSIS ontology enables the representation of soil related data in semantic format. The ontology has been derived from the UML GLOSIS data model v1.0, which itself is based on ISO28258 and is similar to the INSPIRE soil model. The ontology has been created in line with best practices and methodologies, reusing existing standard models and ontologies, including [sosa/ssn](https://www.w3.org/TR/vocab-ssn/) for the representation of observations and measurements, or [skos](https://www.w3.org/2004/02/skos/) for the representation of codelists.

## Matey

A basic point of entry is the YARRRML editor `Matey` available online at https://rml.io/yarrrml/matey/. The standard view of the editor has 4 sections
- a section for input data
- a section to define YARRRML rules
- a section to display RDF output
- a section to visualize exported RML.io rules from YARRRML

YARRRML provides a Quickstart tutorial at https://rml.io/yarrrml/tutorial/getting-started to get acquainted with the interface and YARRRML encoding rules. I recommend to follow the tutorial if you want to proceed after the cookbook, for example with you own data.

## Soil data

We start our cookbook with some typical soil sample analyses data from Africa. Soil samples at location (x_coord,ycoord) at depth (Upper_Depth_Val,Lower_Dept_Val) at a date (datedescribed, YYMM) with a list of observed properties (coSa,meSa,fiSa,vfiSa,coSi,...).

Let's load some data into the first panel of Matey. Note that you can switch between data files with the pull down on the top-left of the panel. The pull down also offers the option to `create new source` or `load a remote source`. Create a new source and name it `soil.csv`. Copy the content below in the panel.

```csv
datedescribed,xcoord,ycoord,SSN,Upper_Depth_Val,Lower_Dept_Val,coSa,meSa,fiSa,vfiSa,coSi,fiSi,Clay,CEC,Carbon,pH_H2O,PH_CaCl2,AWR,Cat_Na,Cat_K,Cat_Ca,Cat_Mg,Micro_Zn,Micro_Mn,Micro_Cu,Micro_Co
7611,28.36,-25.9533333333333,C3975,0,310,11.2,21.1,38.1,,,7.4,20,4,0.5,5.1,4.4,1.899999976,0,0.100000001,0.400000006,0.100000001,0.189999998,14,1.24000001,0.790000021
7611,28.36,-25.9533333333333,C3981,0,280,7.8,11.3,21.2,,,12.7,47,11.7,1.5,6.2,5.4,13.5,0.100000001,0.699999988,2.599999905,3.299999952,1.110000014,175,13.10000038,14.01000023
7611,28.62333333,-25.82666667,C3984,0,180,7.2,32.3,48.2,,,3.5,10,3.7,0.8,5.9,4.9,3,0,0.200000003,0.600000024,0.400000006,0.620000005,4.300000191,0.75999999,0.356999993
7611,28.62333333,-25.8266666666667,C3986,0,380,10.1,33.7,44.9,,,1.6,9.6,2.8,0.6,5.1,4.3,2.099999905,0,0.100000001,0.100000001,0,0.180000007,2.799999952,0.579999983,0.037999999
7611,28.62666667,-25.9766666666667,C1488,0,200,12.7,24.2,34.3,,,31,19.6,3.6,0.47,4.9,4.4,2.599999905,0,0.800000012,0.409999996,0.409999996,0.119999997,75,1.450000048,2.25
7611,28.62666667,-25.9766666666667,C1408,0,250,6.9,15.5,29.1,11.9,4.5,10.4,19.6,4.8,0.84,5.7,4.9,2.299999952,0,0.800000012,1.100000024,0.5,0.310000002,248.5,1.519999981,2.380000114
7611,28.62666667,-25.9766666666667,C3988,0,370,2.8,5,13.6,,,19.9,54.2,21.4,1.63,6.9,5.9,26.5,0.400000006,1.899999976,10.69999981,6.099999905,0.400000006,229.8999939,6.909999847,15.31000042
7611,28.85666667,-25.8566666666667,C3991,0,350,2.1,6.5,13.9,7.9,4.8,13.7,51.4,11.7,1.25,6.1,5.4,8.399999619,0.100000001,0.5,4.800000191,3,0.620000005,189.5,4.909999847,18.03000069
7611,28.85666667,-25.8566666666667,C3995,0,310,7.8,40.4,37.2,,,2.1,12,2.5,0.5,5.4,4.5,2.299999952,0.100000001,0.200000003,0.5,0.300000012,0.159999996,5.25,0.479999989,0.125
7611,29.12,-25.86,C3998,0,270,1.7,20.6,55.6,,,4.9,16,4.4,0.6,5.6,4.5,5.099999905,0,0.300000012,0.600000024,0.100000001,0.159999996,12,0.850000024,0.43900001
7205,29.64638889,-25.6211111111111,C1416,0,300,5.4,12,16.8,6.9,6,11.3,49,11.7,2,5.7,4.9,9.5,0.100000001,1.200000048,3.700000048,2,1.139999986,616.0999756,5.059999943,8.899999619
7208,29.66861111,-25.6905555555556,C1410,0,400,41,34.3,16.3,,,0,5,1.2,0.25,4.8,4.4,2,0,0.100000001,0,0,0.109999999,12.89999962,0.209999993,0.061999999
7611,28.39444444,-25.4405555555556,C4001,0,300,10.9,28.1,40.4,,,4.3,11.9,3.7,0.8,6.4,5.5,4.900000095,0.100000001,0.400000006,1.200000048,0.699999988,0.550000012,14.30000019,1.309999943,0.610000014
7611,28.39444444,-25.4405555555556,C4003,0,310,10.7,14.9,39.6,,,5.5,24.2,3.7,0.6,5.3,4.3,2.700000048,0,0.400000006,0.200000003,0.600000024,0.280000001,9.300000191,0.74000001,0.474000007
7611,28.60194444,-25.4791666666667,C2751,0,300,0.6,2.4,77.7,,,3.7,14.6,4.4,0.4,7,6.1,3.099999905,0.100000001,0.600000024,1.600000024,1,0.219999999,275.2999878,2.279999971,4.599999905
7611,28.60194444,-25.4791666666667,C2735,0,300,0.8,20.9,62.4,,,2.5,12.9,5.1,0.5,6.9,6.2,2.5,0.100000001,0.699999988,1.799999952,1.600000024,0.970000029,144.1000061,1.149999976,2.059999943
7312,26.04444444,-29.0941666666667,C2721,0,330,1,12.5,74.2,,,2.4,9.1,4.5,0.4,6.9,6,2.299999952,0.100000001,0.400000006,1.899999976,1.399999976,0.170000002,101.0999985,0.839999974,1.299999952
7305,26.38194444,-29.0666666666667,C2707,0,450,0.7,2.4,36.3,,,6.9,51.3,23.1,1,8.7,7.6,166.5,0.800000012,0.300000012,20.39999962,5.300000191,0.200000003,276.2000122,3.339999914,3.450000048
7305,26.38333333,-29.125,C2718,0,350,0.9,9,72.1,,,3.5,14.2,4,0.4,7.1,6.2,1.799999952,0.100000001,0.600000024,1.899999976,1.5,0.340000004,176.6999969,1.389999986,2.200000048
7305,26.29111111,-29.2755555555556,C2715,0,350,2,5.5,72.3,,,3.3,15.6,4.8,0.6,6.7,5.9,3.900000095,0.100000001,0.800000012,2.299999952,1.399999976,0.159999996,113.4000015,1.600000024,1.50999999
7305,26.3525,-29.3083333333333,C2739,0,150,1.1,2.9,64.4,,,7.1,24,9.5,1,6.9,6.3,6,0.200000003,1,4.099999905,3.200000048,0.370000005,181.1999969,2.819999933,2.680000067
7212,26.04111111,-29.9866666666667,C2883,0,200,0.2,1.4,66.9,,,10.1,16.3,5.7,0.5,6.7,5.9,2.400000095,0.100000001,0.699999988,2.400000095,1.399999976,1.419999957,200.1999969,1.639999986,2.400000095
7212,26.03055556,-29.9963888888889,C2872,0,150,0.3,1.2,38.9,34.9,8.6,4.3,10.7,4.6,0.3,8.1,7.3,2.299999952,0.100000001,0.400000006,5.5,1,0.340000004,138.5,1.470000029,2.230000019
7303,26.81861111,-29.7008333333333,C2842,0,250,0.9,4.2,48,21.7,8.3,4.8,11.7,4.3,0.4,6.2,5,3.400000095,0.100000001,0.400000006,1.799999952,1.399999976,0.5,106.6999969,1.059999943,1.139999986
7303,26.76222222,-29.6647222222222,C2845,0,280,0.2,1.3,35.9,34.6,8.2,5.6,12.1,5.1,0.6,6.8,5.7,3.200000048,0.100000001,0.699999988,2,1.200000048,1.429999948,164,2.019999981,1.340000033
7207,26.57527778,-29.4588888888889,C1991,0,400,0.5,0.4,37,,,12.5,50.3,25.2,1.2,7.1,6.3,,0.699999988,0.5,19.70000076,6.900000095,0.469999999,362.3999939,3.819999933,4.300000191
7207,26.67388889,-29.4505555555556,C1993,0,250,4.6,1.6,57.8,,,15.7,20.3,8.9,1,6,5.4,3.700000048,0.300000012,0.600000024,3.299999952,2.099999905,0.870000005,234.6000061,2.579999924,3.220000029
7207,26.77722222,-29.3152777777778,C1989,0,300,0.3,2.9,69.2,,,10.7,18.9,7.3,0.7,6.4,5.4,2.799999952,0.200000003,0.400000006,3.700000048,2.099999905,0.419999987,73.5,1.809999943,1.870000005
7207,26.78,-29.1319444444444,C1982,0,300,1.6,1.2,68.4,,,11.1,16,5.3,0.6,6.7,5.6,3.5,0.100000001,0.5,2.599999905,1.299999952,0.600000024,225.6000061,2.49000001,1.970000029
7207,26.92222222,-29.1233333333333,C1954,0,300,1.8,0.8,54.5,,,16,21.3,8,0.65,5.9,4.6,8.100000381,0.400000006,0.200000003,2.799999952,1.899999976,0.200000003,222.6000061,2.180000067,2.640000105
7207,27.14,-29.0133333333333,C1972,0,300,2.9,2.7,72.9,,,9.5,8.4,4.5,0.5,6.6,5.7,2.700000048,0.100000001,0.5,2.099999905,1,0.300000012,124.8000031,1.659999967,1.580000043
7207,27.02444444,-29.2325,C1995,0,350,1.4,2.6,65.7,,,9.2,16.4,5.7,0.5,5.7,5.3,2.5,0.100000001,0.400000006,3.099999905,1,0.219999999,133.1000061,2.359999895,1.350000024
7207,27.01666667,-29.2647222222222,C2001,0,300,0.2,3,34.5,25.3,14.2,8.1,12.2,4.5,0.5,5.7,5.2,22.29999924,0.100000001,0.100000001,2.200000048,1.200000048,0.49000001,57.29999924,2.089999914,1.019999981
7207,26.99055556,-29.3361111111111,C2006,0,300,0.8,2,78,,,5.6,10.2,4,0.5,5.9,5.3,72.38,0.100000001,0.300000012,2.200000048,0.800000012,0.439999998,123.3000031,2.059999943,2.079999924
7207,26.99083333,-29.3447222222222,C2004,0,280,0.8,3.4,70.5,,,10.4,12.3,5.7,0.7,5.7,5.2,28,0.200000003,0.300000012,2.5,1.600000024,0.419999987,108.3000031,2.140000105,1.919999957
7207,27.03333333,-29.4180555555556,C1998,0,250,2,1,54.8,,,22.4,16.5,5.7,0.8,5.8,5.3,1.700000048,0.100000001,0.600000024,2.299999952,1.200000048,1.139999986,300.7999878,2.599999905,1.649999976
7406,24.1025,-28.9644444444444,C3315,0,300,3.4,25,65.3,,,0.4,5.8,2.7,0.9,7.2,6.4,1.700000048,0,0.200000003,1.600000024,0.899999976,0.02,55.5,0.25,0.660000026
7406,24.20194444,-28.9486111111111,C3320,0,400,2.9,28.6,61.9,,,0.3,4.6,1.8,0.1,7.2,6.4,1.600000024,0,0.200000003,1.200000048,0.600000024,0.114770003,55.5,0.229509994,0.680000007
7406,24.62638889,-28.9102777777778,C3318,0,250,2.7,9.6,77.5,,,3.3,6.1,4.6,0.2,7,6.2,2.299999952,0.100000001,0.5,2.599999905,1.100000024,0.059999999,88.69999695,0.920000017,2.279999971
7406,24.86027778,-28.6508333333333,C3323,0,350,3.4,29.6,60.4,,,0.1,6.3,2.9,0.1,7.4,6.5,2.5,0.100000001,0.200000003,1.200000048,1.200000048,0.029999999,89.30000305,0.370000005,0.980000019
7406,24.46666667,-28.5133333333333,C3313,0,300,5.6,15,64.4,,,4.2,10.5,4.6,0.2,7.4,6.5,2.299999952,0,0.300000012,3.5,0.800000012,0.479999989,105.8000031,1.74000001,5.039999962
7406,24.48055556,-28.4327777777778,C3308,0,300,9.8,19.2,59.8,,,2.5,7.4,3.9,0.2,8,7.1,2.599999905,0,0.200000003,3.200000048,0.5,0.039999999,201.5,1.24000001,3.190000057
7302,25.33694444,-28.0905555555556,C2813,0,420,0.5,19.9,73,,,0.9,4.5,2,0.2,6.6,5.7,1.100000024,0.100000001,0.400000006,1.100000024,0.5,0.090000004,70.30000305,0.400000006,0.493420005
7302,25.47361111,-28.1827777777778,C2804,0,350,3.9,29,55.8,,,1.6,9.3,4.5,0.3,7.5,6.6,1.299999952,0.100000001,0.5,2.900000095,1.700000048,0.100000001,78.90000153,1.120000005,3.059999943
7302,25.47777778,-28.2077777777778,C2807,0,350,0.7,22.9,68.8,,,0.5,5,1.7,0.1,6.7,6,1.399999976,0.100000001,0.400000006,1.100000024,0.899999976,0.140000001,60.79999924,0.360000014,0.680000007
7302,25.41722222,-28.225,C2810,0,350,1.4,26.8,60.9,,,1.4,7.4,3.2,0.3,7.6,7,1.700000048,0.100000001,0.600000024,3,1.100000024,0.219999999,105.0999985,0.439999998,1.5
7306,25.92277778,-28.8738888888889,C2748,0,300,0.8,11.1,61.2,,,5.4,20.1,7.5,0.6,7,6.5,5.5,0.100000001,0.400000006,4.400000095,2.099999905,0.150000006,149.3999939,1.960000038,2.25
7302,25.89444444,-28.7016666666667,C2793,0,350,0.6,15.5,76.7,,,0.5,7.9,3,0.2,7.3,6.4,1.299999952,0.100000001,0.300000012,1.899999976,0.800000012,0.239999995,11.60000038,0.589999974,1.25
7302,25.51666667,-28.5672222222222,C2795,0,320,1,7.9,66.3,,,5.4,17.8,8.1,0.6,6.8,5.9,3.900000095,0.100000001,0.400000006,4.900000095,3,0.300000012,378.1000061,3.450000048,5.019999981
7302,25.59,-28.5072222222222,C2819,0,400,0.9,23.2,67.7,,,0.9,7.5,2.8,0.2,6.8,5.6,1.299999952,0.100000001,0.5,1.600000024,0.800000012,0.189999998,129.1000061,0.460000008,0.860000014
```

In the second panel we're going to write our YARRRML rules. We start by defining the GLOSIS prefixes.

```
prefixes:
 glosis_lh: "http://w3id.org/glosis/model/layerhorizon#"
 iso28258: "http://w3id.org/glosis/model/iso28258/2013#"
 sosa:  "http://www.w3.org/ns/sosa/"
 s4a: "http://data.soils4africa-h2020.eu#"  
```

Then continue with the mapping of horizons. Add the section below under the prefices section. Then click `Generate LD` and notice some RDF is shown representing our horizons in Turtle RDF.

```
mappings:
  horizon:
    sources:
      - ['soil.csv~csv']
    s: http://data.soils4africa-h2020.eu/horizon#$(SSN)
    po:
      - [a, glosis_lh:GL_Horizon]
      - [iso28258:upperDepth, $(Upper_Depth_Val)]
      - [iso28258:lowerDepth, $(Lower_Dept_Val)] 
```

Notice how for each record in the csv a GL_Horizon entity is created with a unique identification and an upper and lower property.

Next are the actual observations. Unfortunately our data does not provide any information on the procedures used to produce the measurement result. We start with mapping the Cation Exchange Capacity.

```
  observation:
    sources:
       - ['soil.csv~csv']
    s: http://data.soils4africa-h2020.eu/observation/CEC#$(SSN)
    po:
      - [a, glosis_lh:EffectiveCec]
      - [sosa:observedProperty, glosis_lh:EffectiveCecProperty]
      - [sosa:hasResult,  $(CEC)]
      - p: sosa:hasFeatureOfInterest
        o: 
          mapping: horizon
          condition:
            function: equal
            parameters:
              - [str1, $(CEC), s]
              - [str2, $(CEC), o]
```

You can extend the mapping by adding additional rules.

## Publishing RDF into a triple store

A typical mechanism to publish RDF generated with YARRRML to a triple store is to convert the YARRRML rules to RML rules and use these in a data workflow in which data is transformed and loaded on a triplestore in an automated way. For example with the [RMLMapper](https://github.com/RMLio/rmlmapper-java) or [RMLStreamer tool](https://github.com/RMLio/RMLStreamer) which can be triggered as a docker image for example in a workflow step.

```
docker run -v $PWD:/data --rm rmlio/rmlstreamer toFile -m /data/mapping.ttl -o /data/output
```

An interesting initiative using this approach is the [data to services](https://github.com/MaastrichtU-IDS/data2services-pipeline) pipeline project by Maastricht University.
